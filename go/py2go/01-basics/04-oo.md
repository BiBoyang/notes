# 面向对象

Date: 2019-11-25

根据这么多年人们的编程实践，工业界一直在批判使用继承的模式，或者至少尽量避免使用复杂的继承，而尽量多使用 interface。所以现在好多新兴的语言，比如 Golang 和 Rust 都直接不支持继承了。

和 C++ 一样，struct(class) 是实现面向对象的基石，但是，Golang 是不支持继承的，而只能通过组合实现复用功能。Golang 支持一种特殊的骚操作，叫做 struct 嵌入。这样一个 struct 就可以直接调用被嵌入的 struct 的属性和方法，听起来有点像继承，而且的确实现了继承的功能，但的确不是继承，而是组合。

在 Go 语言中没有 private 和 public 这些关键字。如果变量名字是大写字母开头的，那么就是导出的，如果是小写字母开头的，那么就是包内私有的变量。

NewPerson constructs a new person struct with the given name
You can safely return a pointer to local variable as a local variable will survive the scope of the function.

```go
func NewPerson(name string) *person {
    p := person{name: name}
    p.age = 42
    return &p
}
```

structs 勉强可以对应 python 里的 dataclass，也是用大括号初始化。从这点上可以看到 golang 还是相当统一的。

Go 的面向对象和 Python 有很大的区别。相对来说，Go 的面向对象更原始，更正宗一些，也就是隐含的是消息传递的语义。

```go
func (r *rect) area() int {
    return r.width * r.height
}

func (r rect) perim() int {
    return 2*r.width + 2*r.height
}
```

使用 receiver 既可以是指针也可以直接是对象，指针用于 inplace 改变对象，而直接传值则方便变化而不影响到原对象。

Go automatically handles conversion between values and pointers for method calls. You may want to use a pointer receiver type to avoid copying on method calls or to allow the method to mutate the receiving struct.

## 接口

接口类似于 Python 中的抽象基类，只需要实现了接口中的所有方法就是实现了这个接口。

```go
type geometry interface {
    area() float64
    perim() float64
}
```

